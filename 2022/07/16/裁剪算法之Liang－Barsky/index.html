<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Revves_J">







<title>裁剪算法之Liang－Barsky | YiMing</title>



    <link rel="icon" href="/jjymsworld/favicon.ico">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/jjymsworld/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/jjymsworld/js/menu.js"></script>
    




    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>







  <!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/jjymsworld/">
          
            <img class="logo-img" src="/jjymsworld/logo2.png" alt="logo_image">
          
        </a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/jjymsworld/">Home</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/jjymsworld/archives/">Archive</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/jjymsworld/categories/gallery/">Gallery</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/jjymsworld/tag/">Tags</a>
              </li> 
                   
          
          
            <li class="menu-item search-btn">
              <a href="#">Search</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </div>
</div>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
                
                    <span class="post-tag">
                        <a href="/jjymsworld/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/">
                            计算机图形学
                        </a>
                    </span>    
                           
            
        </div>
        <div class="post-title">
            
            
                裁剪算法之Liang－Barsky
            
            
        </div>
        <span class="post-date">
            7月 16, 2022
        </span>
    </div>
    <div class="post-img">
        
            <div class="h-line-primary"></div>
              
    </div>
</div>
    <div class="post-content">
    <h2 id="一-概念"><a href="#一-概念" class="headerlink" title="一. 概念"></a>一. 概念</h2><p>裁剪是CG中许多重要问题的基础，裁剪最典型的用途是确定场景中或画面中位于给定区域之内的部分。由于在一个典型的场景中，需要对大量的点、线段进行裁剪，因此裁剪算法的效率十分重要。</p>
<p>关于裁剪有一些很常见的算法，比如说Cohen-Sutherland线段细分裁剪算法、中点分割算法、Cyrus-Beck算法、Liang-Barsky算法等。这里主要介绍Liang-Barsky算法。</p>
<h2 id="二-Liang-Barsky算法"><a href="#二-Liang-Barsky算法" class="headerlink" title="二. Liang-Barsky算法"></a>二. Liang-Barsky算法</h2><p>首先知道直线和裁剪框的位置关系，如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/20181109022843394.png"></p>
<p>可以看到直线可能完全在裁剪框的外面，也可能完全在裁剪框的里面，或者和裁剪框相交。</p>
<p>所以裁剪的规则是这样的：</p>
<ol>
<li><p>如果直线的两个端点都在窗口边界内，如ab，则直线保留；</p>
</li>
<li><p>如果直线的一个端点在窗口边界之内，另一个端点在窗口边界之外，如ef，则应从直线与边界的而交点处裁剪掉；</p>
</li>
<li><p>如果直线的两个端点都在窗口边界之外，则分两种情况：</p>
<ul>
<li>一种情况如ij，直线全部在窗口之外，应该全部裁剪掉；</li>
<li>另一种情况如gh，直接横穿窗口边界，应该保留相交的片段，裁剪掉剩余的片段。</li>
</ul>
</li>
</ol>
<hr>
<p><strong>算法推导：</strong></p>
<p>如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/liang2.png"></p>
<p>这里用参数方程表示直线P<del>1</del>P<del>2</del>,其中t是一个参数，t∈[0,1]：</p>
<p>​	<img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/liang3.png"></p>
<p>裁剪区域内部可以表达为两个不等式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/2018110902451641.png"></p>
<p>把上述参数方程代入得到不等式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/20181109024816121.png"></p>
<p>即</p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/20181109024844225.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/20181109024906302.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/20181109025824716.png"></p>
<p><strong>把直线看成是一条有方向的线段，把窗口的四条边及其延长线分成两类：入边和出边</strong></p>
<p>入边：左边界和下边界—-从裁剪框外向内</p>
<p>出边：右边界和上边界—-从裁剪框内向外</p>
<p><img src="https://cdn.jsdelivr.net/gh/qq171895821/Jymscloudiimmgg@main/img/20181109030255360.png"></p>
<p><strong>分情况讨论</strong></p>
<ol>
<li>d&#x3D;0，q&lt;0, 说明直线与裁剪框平行，并且位于裁剪框的外面，直线为不可见，可抛弃，直接结束。q&gt;&#x3D;0，说明直线在它所平行的窗口边界的内部，还需进一步计算确定直线是否在窗口内、外、或者相交</li>
<li>d&lt;0，说明直线是从裁剪边界的外部延伸到内部</li>
<li>d&gt;0,  说明直线是从裁剪边界的内部延伸到外部</li>
</ol>
<p>对于d≠0，可以利用式子计算直线与边界k的交点的参数u。对于每条直线，可以计算直线位于裁剪窗口内线段的参数d1和d2</p>
<p>  d1的值是由那些使得直线是从外部延伸到内部的窗口边界决定。对于这些边计算ri &#x3D; qi&#x2F;di.</p>
<p>  d1 &#x3D; max(ri,0)</p>
<p> d2的值是由那些使得直线是从内部延伸到窗口边界决定</p>
<p> d2 &#x3D; min(ri,1)</p>
<p>  如果d1&gt;d2,这条直线完全在窗口的外面，不可见，可抛弃，否则，根据参数u的两个值，计算出裁剪后线段的端点</p>
<h3 id="伪代码如下："><a href="#伪代码如下：" class="headerlink" title="伪代码如下："></a>伪代码如下：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Liang-Barsky two-dimensional clipping algorithm</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">P1 and P2 are the line end points with components x1,y1,x2,y2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">tL and tU are the lower and upper parametric limits</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">xL,xR,yB,yT are the left,right,bottom and top window edges</span></span><br><span class="line">	function clipt(d,q,tL,tU):</span><br><span class="line">		clipt performs trivial rejection tests and finds</span><br><span class="line">		the max of the lower set of parameter values and </span><br><span class="line">		the min of the upper set of parameter values</span><br><span class="line">		</span><br><span class="line">		visible = true</span><br><span class="line">		if d=0 and q&lt;0 then #line is outside and parallel to edge</span><br><span class="line">			visible = false</span><br><span class="line">		else if d &lt; 0 then #looking for upper limit</span><br><span class="line">			t = q/d</span><br><span class="line">			if t&gt;tU then #check for trivial invisible</span><br><span class="line">				visible = false</span><br><span class="line">			else if t&gt;tL then #find the min of the max</span><br><span class="line">				tL = t</span><br><span class="line">			end if</span><br><span class="line">		else if d&gt;0 then #look for the lower limit</span><br><span class="line">			t = q/d</span><br><span class="line">			if t&lt;tL then #check for trivial invisible</span><br><span class="line">				visible = false</span><br><span class="line">			else if t&lt;tU then #find the max of the min</span><br><span class="line">				tU = t</span><br><span class="line">			end if</span><br><span class="line">			</span><br><span class="line">		end if</span><br><span class="line">		return visible</span><br><span class="line">	end function</span><br><span class="line">	</span><br><span class="line">	start the main funciton:</span><br><span class="line">		tL=0,tU=1</span><br><span class="line">		delatx = x2-x1</span><br><span class="line">		if clipt(-delatx,x1-xL,tL,tU) = true then #left edge</span><br><span class="line">			if clipt(delatx,xR-x1,tL,tU) = true then #right edge</span><br><span class="line">				deltay = y2-y1</span><br><span class="line">				if clipt(-deltay,y1-yB,tL,tU) = true then #bottom edge</span><br><span class="line">					if clipt(deltay,yT-y1,tL,tU) = true then #top edge</span><br><span class="line">						if tU&lt;1 then </span><br><span class="line">							x2 = x1+tU*delatx</span><br><span class="line">							y2 = y1+tU*deltay</span><br><span class="line">						end if</span><br><span class="line">						if tL&gt;0 then</span><br><span class="line">							x1 = x1+tL*deltax</span><br><span class="line">							y1 = y1+tL*deltay</span><br><span class="line">						end if</span><br><span class="line">						Draw P1,P2</span><br><span class="line">					end if</span><br><span class="line">				end if</span><br><span class="line">			end if</span><br><span class="line">		end if</span><br></pre></td></tr></table></figure>



<h3 id="openGL实现代码："><a href="#openGL实现代码：" class="headerlink" title="openGL实现代码："></a>openGL实现代码：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">float</span> xmin,xmax,ymin,ymax;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myinit</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glShadeModel</span> (GL_FLAT);</span><br><span class="line">    <span class="built_in">glClearColor</span> (<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myReshape</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">    <span class="built_in">glMatrixMode</span>(GL_PROJECTION);</span><br><span class="line">    <span class="built_in">glLoadIdentity</span>();</span><br><span class="line">    <span class="keyword">if</span> (w &lt;= h) </span><br><span class="line">	<span class="built_in">gluOrtho2D</span> (<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>*(GLfloat)h/(GLfloat)w);</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">	<span class="built_in">gluOrtho2D</span> (<span class="number">0.0</span>, <span class="number">1.0</span>*(GLfloat)w/(GLfloat)h, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="built_in">glMatrixMode</span>(GL_MODELVIEW);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Clip</span><span class="params">(<span class="type">float</span> p,<span class="type">float</span> q,<span class="type">float</span> *tL,<span class="type">float</span> *tU)</span> </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	<span class="type">int</span> flag=<span class="number">1</span>;<span class="comment">/*flag为标志变量0表示舍弃1表示可见*/</span> </span><br><span class="line">	<span class="type">float</span> r; </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span> (p&lt;<span class="number">0.0</span>) </span><br><span class="line">	&#123; </span><br><span class="line">		r=q/p; </span><br><span class="line">		<span class="keyword">if</span> (r&gt;*tU)</span><br><span class="line">			flag=<span class="number">0</span>; </span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (r&gt;*tL) &#123;</span><br><span class="line">			*tL = r;<span class="comment">/*m取进入点最大参数值*/</span> </span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (p&gt;<span class="number">0.0</span>) &#123; </span><br><span class="line">		r=q/p; </span><br><span class="line">		<span class="keyword">if</span> (r&lt;*tL)</span><br><span class="line">			flag=<span class="number">0</span>; </span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (r&lt;*tU) &#123;</span><br><span class="line">			*tU = r;<span class="comment">/*n取离开点的最小值*/</span> </span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (q&lt;<span class="number">0</span> &amp;&amp; p==<span class="number">0</span>) <span class="comment">//平行于边界而且在界外的线 </span></span><br><span class="line">		flag=<span class="number">0</span>; </span><br><span class="line">	<span class="keyword">return</span> flag; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myclip</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// line clipping algorithm </span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> dx, dy, x1,tL,tU, x2, y1, y2;</span><br><span class="line">	tL = <span class="number">0</span>, tU = <span class="number">1.0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入线段的两个顶点坐标x1,y1,x2,y2:\n&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%f%f%f%f&quot;</span>,&amp;x1,&amp;y1,&amp;x2,&amp;y2);</span><br><span class="line"> </span><br><span class="line">	<span class="built_in">glBegin</span>(GL_LINES); </span><br><span class="line">	<span class="built_in">glColor4f</span> (<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>); </span><br><span class="line">	<span class="built_in">glVertex2f</span>(x1, y1); <span class="comment">// line startpoint </span></span><br><span class="line">	<span class="built_in">glVertex2f</span>(x2, y2); <span class="comment">// line endpoint </span></span><br><span class="line">	<span class="built_in">glEnd</span>(); </span><br><span class="line"> </span><br><span class="line">	dx=x2-x1; </span><br><span class="line">  </span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">Clip</span>(-dx, x1 - xmin, &amp;tL, &amp;tU))</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">Clip</span>(dx, xmax - x1, &amp;tL, &amp;tU))&#123;</span><br><span class="line">			dy=y2-y1; </span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">Clip</span>(-dy, y1 - ymin, &amp;tL, &amp;tU))</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">Clip</span>(dy, ymax - y1, &amp;tL, &amp;tU))</span><br><span class="line">				&#123; </span><br><span class="line">					<span class="keyword">if</span> (tU&lt;<span class="number">1.0</span>) </span><br><span class="line">					&#123; </span><br><span class="line">						x2 = x1 + tU*dx;<span class="comment">//通过n求得裁剪后的p2端点 </span></span><br><span class="line">						y2 = y1 + tU*dy;</span><br><span class="line">					&#125; </span><br><span class="line">					<span class="keyword">if</span> (tL&gt;<span class="number">0.0</span>)</span><br><span class="line">					&#123; </span><br><span class="line">						x1 = x1 + tL*dx;<span class="comment">//通过m求得裁剪后的p1端点 </span></span><br><span class="line">						y1 = y1 + tL*dy;</span><br><span class="line">					&#125; </span><br><span class="line">					<span class="built_in">glBegin</span>(GL_LINES); </span><br><span class="line">					<span class="built_in">glColor4f</span> (<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>); </span><br><span class="line">					<span class="built_in">glVertex2f</span>( x1, y1); <span class="comment">// clipped line startpoint </span></span><br><span class="line">					<span class="built_in">glVertex2f</span>( x2, y2); <span class="comment">// clipped line endpoint </span></span><br><span class="line">					<span class="built_in">glEnd</span>();</span><br><span class="line">				&#125; </span><br><span class="line">		&#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"> </span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请分别输入矩形的左右下上边界：\n&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%f%f%f%f&quot;</span>,&amp;xmin,&amp;xmax,&amp;ymin,&amp;ymax);</span><br><span class="line">    <span class="built_in">glColor4f</span> (<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.75</span>);</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_POLYGON);</span><br><span class="line">	<span class="built_in">glVertex2f</span>( xmin, ymin); <span class="comment">// Bottom Left</span></span><br><span class="line">	<span class="built_in">glVertex2f</span>( xmax, ymin); <span class="comment">// Bottom Left</span></span><br><span class="line">	<span class="built_in">glVertex2f</span>( xmax, ymax); <span class="comment">// Bottom Right</span></span><br><span class="line">	<span class="built_in">glVertex2f</span>( xmin, ymax); <span class="comment">// Bottom Right</span></span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line"> </span><br><span class="line">   <span class="built_in">myclip</span>();</span><br><span class="line">    <span class="built_in">glFlush</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*  Main Loop</span></span><br><span class="line"><span class="comment"> *  Open window with initial window size, title bar, </span></span><br><span class="line"><span class="comment"> *  RGBA display mode, and handle input events.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">glutInit</span>(&amp;argc, argv);</span><br><span class="line">   <span class="built_in">glutInitDisplayMode</span> (GLUT_SINGLE | GLUT_RGBA);</span><br><span class="line">   <span class="comment">//define size and the relative positon of the applicaiton window on the display</span></span><br><span class="line">   <span class="built_in">glutInitWindowSize</span> (<span class="number">500</span>, <span class="number">500</span>); </span><br><span class="line">   <span class="built_in">glutInitWindowPosition</span> (<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"> 	<span class="comment">//init the defined window with &quot;argv[1]&quot; as topic showed on the top the window</span></span><br><span class="line">   <span class="built_in">glutCreateWindow</span> (argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="comment">// opengl setup</span></span><br><span class="line">   <span class="built_in">myinit</span> ();</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//define callbacks</span></span><br><span class="line">   <span class="built_in">glutDisplayFunc</span>(display); </span><br><span class="line">   <span class="built_in">glutReshapeFunc</span>(myReshape);</span><br><span class="line">   <span class="comment">//enter the loop for display</span></span><br><span class="line">   <span class="built_in">glutMainLoop</span>();</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="MFC实现代码："><a href="#MFC实现代码：" class="headerlink" title="MFC实现代码："></a>MFC实现代码：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 511works.cpp : 定义应用程序的入口点。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;framework.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;511works.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atlstr.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_LOADSTRING 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局变量:</span></span><br><span class="line">HINSTANCE hInst;                                <span class="comment">// 当前实例</span></span><br><span class="line">WCHAR szTitle[MAX_LOADSTRING];                  <span class="comment">// 标题栏文本</span></span><br><span class="line">WCHAR szWindowClass[MAX_LOADSTRING];            <span class="comment">// 主窗口类名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义全局变量</span></span><br><span class="line">POINT point[<span class="number">2</span>];</span><br><span class="line">POINT LinePoint[<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> position = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> LinePosition = <span class="number">0</span>;</span><br><span class="line">RECT rect;</span><br><span class="line">POINT p;</span><br><span class="line"><span class="type">int</span> xmin, xmax, ymin, ymax;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数声明</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myclip</span><span class="params">(HDC hdc, HWND hWnd)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetMinMax</span><span class="params">(POINT* point)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此代码模块中包含的函数的前向声明:</span></span><br><span class="line"><span class="function">ATOM                <span class="title">MyRegisterClass</span><span class="params">(HINSTANCE hInstance)</span></span>;</span><br><span class="line"><span class="function">BOOL                <span class="title">InitInstance</span><span class="params">(HINSTANCE, <span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function">LRESULT CALLBACK    <span class="title">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"><span class="function">INT_PTR CALLBACK    <span class="title">About</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> APIENTRY <span class="title">wWinMain</span><span class="params">(_In_ HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">                     _In_opt_ HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">                     _In_ LPWSTR    lpCmdLine,</span></span></span><br><span class="line"><span class="params"><span class="function">                     _In_ <span class="type">int</span>       nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">UNREFERENCED_PARAMETER</span>(hPrevInstance);</span><br><span class="line">    <span class="built_in">UNREFERENCED_PARAMETER</span>(lpCmdLine);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 在此处放置代码。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化全局字符串</span></span><br><span class="line">    <span class="built_in">LoadStringW</span>(hInstance, IDS_APP_TITLE, szTitle, MAX_LOADSTRING);</span><br><span class="line">    <span class="built_in">LoadStringW</span>(hInstance, IDC_MY511WORKS, szWindowClass, MAX_LOADSTRING);</span><br><span class="line">    <span class="built_in">MyRegisterClass</span>(hInstance);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行应用程序初始化:</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">InitInstance</span> (hInstance, nCmdShow))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HACCEL hAccelTable = <span class="built_in">LoadAccelerators</span>(hInstance, <span class="built_in">MAKEINTRESOURCE</span>(IDC_MY511WORKS));</span><br><span class="line"></span><br><span class="line">    MSG msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主消息循环:</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">GetMessage</span>(&amp;msg, <span class="literal">nullptr</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">TranslateAccelerator</span>(msg.hwnd, hAccelTable, &amp;msg))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line">            <span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>) msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  函数: MyRegisterClass()</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  目标: 注册窗口类。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">ATOM <span class="title">MyRegisterClass</span><span class="params">(HINSTANCE hInstance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    WNDCLASSEXW wcex;</span><br><span class="line"></span><br><span class="line">    wcex.cbSize = <span class="built_in">sizeof</span>(WNDCLASSEX);</span><br><span class="line"></span><br><span class="line">    wcex.style          = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line">    wcex.lpfnWndProc    = WndProc;</span><br><span class="line">    wcex.cbClsExtra     = <span class="number">0</span>;</span><br><span class="line">    wcex.cbWndExtra     = <span class="number">0</span>;</span><br><span class="line">    wcex.hInstance      = hInstance;</span><br><span class="line">    wcex.hIcon          = <span class="built_in">LoadIcon</span>(hInstance, <span class="built_in">MAKEINTRESOURCE</span>(IDI_MY511WORKS));</span><br><span class="line">    wcex.hCursor        = <span class="built_in">LoadCursor</span>(<span class="literal">nullptr</span>, IDC_ARROW);</span><br><span class="line">    wcex.hbrBackground  = (HBRUSH)(COLOR_WINDOW+<span class="number">1</span>);</span><br><span class="line">    wcex.lpszMenuName   = <span class="built_in">MAKEINTRESOURCEW</span>(IDC_MY511WORKS);</span><br><span class="line">    wcex.lpszClassName  = szWindowClass;</span><br><span class="line">    wcex.hIconSm        = <span class="built_in">LoadIcon</span>(wcex.hInstance, <span class="built_in">MAKEINTRESOURCE</span>(IDI_SMALL));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">RegisterClassExW</span>(&amp;wcex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   函数: InitInstance(HINSTANCE, int)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   目标: 保存实例句柄并创建主窗口</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   注释:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        在此函数中，我们在全局变量中保存实例句柄并</span></span><br><span class="line"><span class="comment">//        创建和显示主程序窗口。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">BOOL <span class="title">InitInstance</span><span class="params">(HINSTANCE hInstance, <span class="type">int</span> nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   hInst = hInstance; <span class="comment">// 将实例句柄存储在全局变量中</span></span><br><span class="line"></span><br><span class="line">   HWND hWnd = <span class="built_in">CreateWindowW</span>(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,</span><br><span class="line">      CW_USEDEFAULT, <span class="number">0</span>, CW_USEDEFAULT, <span class="number">0</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, hInstance, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!hWnd)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">return</span> FALSE;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">ShowWindow</span>(hWnd, nCmdShow);</span><br><span class="line">   <span class="built_in">UpdateWindow</span>(hWnd);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  函数: WndProc(HWND, UINT, WPARAM, LPARAM)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  目标: 处理主窗口的消息。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  WM_COMMAND  - 处理应用程序菜单</span></span><br><span class="line"><span class="comment">//  WM_PAINT    - 绘制主窗口</span></span><br><span class="line"><span class="comment">//  WM_DESTROY  - 发送退出消息并返回</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="keyword">switch</span> (message)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> wmId = <span class="built_in">LOWORD</span>(wParam);</span><br><span class="line">            <span class="comment">// 分析菜单选择:</span></span><br><span class="line">            <span class="keyword">switch</span> (wmId)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> IDM_ABOUT:</span><br><span class="line">                <span class="built_in">DialogBox</span>(hInst, <span class="built_in">MAKEINTRESOURCE</span>(IDD_ABOUTBOX), hWnd, About);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> IDM_EXIT:</span><br><span class="line">                <span class="built_in">DestroyWindow</span>(hWnd);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ID_JUXING:</span><br><span class="line">                hdc = <span class="built_in">GetDC</span>(hWnd);</span><br><span class="line">                <span class="built_in">Rectangle</span>(hdc, point[<span class="number">0</span>].x, point[<span class="number">0</span>].y, point[<span class="number">1</span>].x, point[<span class="number">1</span>].y);</span><br><span class="line">                <span class="built_in">UpdateWindow</span>(hWnd);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ID_DRAWLINE:</span><br><span class="line">                hdc = <span class="built_in">GetDC</span>(hWnd);</span><br><span class="line">                <span class="built_in">MoveToEx</span>(hdc, LinePoint[LinePosition - <span class="number">2</span>].x, LinePoint[LinePosition - <span class="number">2</span>].y, <span class="literal">NULL</span>);</span><br><span class="line">                <span class="built_in">LineTo</span>(hdc, LinePoint[LinePosition - <span class="number">1</span>].x, LinePoint[LinePosition - <span class="number">1</span>].y);</span><br><span class="line">                <span class="built_in">UpdateWindow</span>(hWnd);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ID_CUT:</span><br><span class="line">                hdc = <span class="built_in">GetDC</span>(hWnd);</span><br><span class="line">                <span class="built_in">GetMinMax</span>(point);</span><br><span class="line">                <span class="built_in">myclip</span>(hdc, hWnd);</span><br><span class="line">                <span class="built_in">UpdateWindow</span>(hWnd);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hWnd, message, wParam, lParam);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_LBUTTONDOWN:</span><br><span class="line">        hdc = <span class="built_in">GetDC</span>(hWnd);</span><br><span class="line">        position = position % <span class="number">2</span>;</span><br><span class="line">        point[position].x = <span class="built_in">LOWORD</span>(lParam);</span><br><span class="line">        point[position].y = <span class="built_in">HIWORD</span>(lParam);</span><br><span class="line">        position++;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_RBUTTONDOWN:</span><br><span class="line">        hdc = <span class="built_in">GetDC</span>(hWnd);</span><br><span class="line">        LinePoint[LinePosition].x = <span class="built_in">LOWORD</span>(lParam);</span><br><span class="line">        LinePoint[LinePosition].y = <span class="built_in">HIWORD</span>(lParam);</span><br><span class="line">        LinePosition++;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">        &#123;</span><br><span class="line">            PAINTSTRUCT ps;</span><br><span class="line">            hdc = <span class="built_in">BeginPaint</span>(hWnd, &amp;ps);</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 在此处添加使用 hdc 的任何绘图代码...</span></span><br><span class="line">            <span class="built_in">EndPaint</span>(hWnd, &amp;ps);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        <span class="built_in">PostQuitMessage</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// “关于”框的消息处理程序。</span></span><br><span class="line"><span class="function">INT_PTR CALLBACK <span class="title">About</span><span class="params">(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">UNREFERENCED_PARAMETER</span>(lParam);</span><br><span class="line">    <span class="keyword">switch</span> (message)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_INITDIALOG:</span><br><span class="line">        <span class="keyword">return</span> (INT_PTR)TRUE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">LOWORD</span>(wParam) == IDOK || <span class="built_in">LOWORD</span>(wParam) == IDCANCEL)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">EndDialog</span>(hDlg, <span class="built_in">LOWORD</span>(wParam));</span><br><span class="line">            <span class="keyword">return</span> (INT_PTR)TRUE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (INT_PTR)FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetMinMax</span><span class="params">(POINT * point)</span> </span>&#123;</span><br><span class="line">    xmin = point[<span class="number">0</span>].x;</span><br><span class="line">    xmax = point[<span class="number">1</span>].x;</span><br><span class="line">    ymin = point[<span class="number">0</span>].y;</span><br><span class="line">    ymax = point[<span class="number">1</span>].y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">clip</span><span class="params">(<span class="type">float</span> p, <span class="type">float</span> q, <span class="type">float</span>* tL, <span class="type">float</span>* tU)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">1</span>; <span class="comment">//0表示舍弃1表示可见</span></span><br><span class="line">    <span class="type">float</span> r;</span><br><span class="line">    <span class="keyword">if</span> (p &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">        r = q / p;</span><br><span class="line">        <span class="keyword">if</span> (r &gt; *tU) &#123;</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (r &gt; *tL) &#123;</span><br><span class="line">            *tL = r;<span class="comment">//取进入点最大参数值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (p &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">        r = q / p;</span><br><span class="line">        <span class="keyword">if</span> (r &lt; *tL) &#123;</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (r &lt; *tU) &#123;</span><br><span class="line">            *tU = r;<span class="comment">//取离开点最小参数值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (q &lt; <span class="number">0</span> &amp;&amp; p == <span class="number">0</span>) &#123;</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myclip</span><span class="params">(HDC hdc, HWND hWnd)</span> </span>&#123;</span><br><span class="line">    HPEN hp;</span><br><span class="line">    <span class="type">float</span> dx, dy, x1, tL, tU, x2, y1, y2;</span><br><span class="line">    tL = <span class="number">0</span>, tU = <span class="number">1.0</span>;</span><br><span class="line">    x1 = LinePoint[LinePosition - <span class="number">2</span>].x;</span><br><span class="line">    y1 = LinePoint[LinePosition - <span class="number">2</span>].y;</span><br><span class="line">    x2 = LinePoint[LinePosition - <span class="number">1</span>].x;</span><br><span class="line">    y2 = LinePoint[LinePosition - <span class="number">1</span>].y;</span><br><span class="line">    dx = x2 - x1;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">clip</span>(-dx, x1 - xmin, &amp;tL, &amp;tU)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">clip</span>(dx, xmax - x1, &amp;tL, &amp;tU)) &#123;</span><br><span class="line">            dy = y2 - y1;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">clip</span>(-dy, y1 - ymin, &amp;tL, &amp;tU)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">clip</span>(dy, ymax - y1, &amp;tL, &amp;tU)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tU &lt; <span class="number">1.0</span>) &#123;</span><br><span class="line">                        x2 = x1 + tU * dx;</span><br><span class="line">                        y2 = y1 + tU * dy;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (tL &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">                        x1 = x1 + tL * dx;</span><br><span class="line">                        y1 = y1 + tL * dy;</span><br><span class="line">                    &#125;</span><br><span class="line">                    hp = <span class="built_in">CreatePen</span>(PS_SOLID, <span class="number">1</span>, <span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">                    <span class="built_in">SelectObject</span>(hdc, hp);</span><br><span class="line">                    <span class="built_in">MoveToEx</span>(hdc, x1, y1, <span class="literal">NULL</span>);</span><br><span class="line">                    <span class="built_in">LineTo</span>(hdc, x2, y2);</span><br><span class="line">                    <span class="built_in">DeleteObject</span>(hp);</span><br><span class="line">                    string tLString = <span class="built_in">to_string</span>(tL);</span><br><span class="line">                    string tUString = <span class="built_in">to_string</span>(tU);</span><br><span class="line">                    LPCTSTR startParams = <span class="string">L&quot;开始组参数: &quot;</span>;</span><br><span class="line">                    LPCTSTR endParams = <span class="string">L&quot;结束组参数: &quot;</span>;</span><br><span class="line">                    LPCTSTR pointposition = <span class="string">L&quot;裁剪后线段端点分别为(顺序为x1,y1,x2,y2): &quot;</span>;</span><br><span class="line">                    string x1string = <span class="built_in">to_string</span>(x1);</span><br><span class="line">                    string x2string = <span class="built_in">to_string</span>(x2);</span><br><span class="line">                    string y1string = <span class="built_in">to_string</span>(y1);</span><br><span class="line">                    string y2string = <span class="built_in">to_string</span>(y2);</span><br><span class="line">                    CString content = <span class="built_in">CString</span>(startParams) + <span class="built_in">CString</span>(tLString.<span class="built_in">c_str</span>()) + <span class="built_in">CString</span>(endParams) + <span class="built_in">CString</span>(tUString.<span class="built_in">c_str</span>()) + <span class="built_in">CString</span>(pointposition) + <span class="built_in">CString</span>(x1string.<span class="built_in">c_str</span>()) + <span class="built_in">CString</span>(<span class="string">L&quot; &quot;</span>) + <span class="built_in">CString</span>(y1string.<span class="built_in">c_str</span>()) + <span class="built_in">CString</span>(<span class="string">L&quot; &quot;</span>) + <span class="built_in">CString</span>(x2string.<span class="built_in">c_str</span>()) + <span class="built_in">CString</span>(<span class="string">L&quot; &quot;</span>) + <span class="built_in">CString</span>(y2string.<span class="built_in">c_str</span>());</span><br><span class="line">                    <span class="built_in">MessageBox</span>(hWnd, content, <span class="string">L&quot;result&quot;</span>, MB_OK);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
                <div class="icon arrow-left"></div>
                <div class="post-link">
                    <a href="/jjymsworld/2022/07/16/%E7%A7%8D%E5%AD%90%E5%A1%AB%E8%89%B2%E7%AE%97%E6%B3%95/">Prev</a>
                </div>
            
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/jjymsworld/2022/07/16/KMP%E7%AE%97%E6%B3%95/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

    
      <div class="post-comment">

     

    
        <div id="disqus_thread"></div>
        <script>
            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
            
            var disqus_config = function () {
                this.page.url = 'https://jjymsworld.github.io/jjymsworld/2022/07/16/%E8%A3%81%E5%89%AA%E7%AE%97%E6%B3%95%E4%B9%8BLiang%EF%BC%8DBarsky/';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = '2022/07/16/裁剪算法之Liang－Barsky/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                this.language = 'en'
            };
            
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://versatile1.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>   
     
    
    

</div>
     
  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
            
                
        </div>
    </div>
</div>

    </div>

    
      <div class="search-popup">
    <div class="search-popup-overlay">  
    </div>
    <div class="search-popup-window" >
        <div class="search-header">
            <div class="search-input-container">
              <input autocomplete="off" autocapitalize="off" maxlength="80"
                     placeholder="Search Anything" spellcheck="false"
                     type="search" class="search-input">
            </div>
            <div class="search-close-btn">
                <div class="icon close-btn"></div>
            </div>
        </div>
        <div class="search-result-container">
        </div>
    </div>
</div>

<script>
    const searchConfig = {
        path             : "/jjymsworld/search.xml",
        top_n_per_article: "1",
        unescape         : "false",
        trigger: "auto",
        preload: "false"
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script>
<script src="js/search.js"></script>
    
    

  </body>
</html>
